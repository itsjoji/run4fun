<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Endless Platformer</title>

<style>
  :root{
    --bg:#4b8ce6;
    --platform:#2ea044;
    --player:#ffd42a;
  }
  html,body{
    margin:0;
    height:100%;
    background:#4b8ce6;
    overflow:hidden;
  }
  canvas{
    display:block;
    width:100vw;
    height:100vh;
    background:#4b8ce6;
  }

  #centerOverlay{
    position:absolute;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    color:white;
    text-align:center;
    font-size:30px;
    pointer-events:none;
    text-shadow:0 0 8px black;
  }

  /* Restored + improved Dark Souls YOU DIED screen */
  #deathScreen{
    position:absolute;
    inset:0;
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:72px;
    font-weight:700;
    color:#aa1a1a;
    text-shadow:0 0 18px #000, 0 0 6px #000;
    background:rgba(0,0,0,0.60);
    opacity:0;
    pointer-events:none;
    transition:opacity 0.8s ease-out;
    letter-spacing:4px;
    font-family:"Georgia", serif;
  }

  #touchButton{
    position:absolute;
    right:20px;
    bottom:20px;
    width:75px;
    height:75px;
    border-radius:50%;
    background:#ffd42a;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:bold;
    user-select:none;
  }
  @media (min-width:700px){
    #touchButton{display:none;}
  }
</style>
</head>

<body>
<canvas id="game"></canvas>

<div id="centerOverlay">Tap / Space to Start</div>
<div id="deathScreen">YOU DIED</div>
<div id="touchButton">▲</div>

<script>
(() => {

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
let DPR = window.devicePixelRatio || 1;

function resize(){
  DPR = window.devicePixelRatio || 1;
  canvas.width = innerWidth * DPR;
  canvas.height = innerHeight * DPR;
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
resize();
window.addEventListener("resize", resize);

const WORLD = {
  width: () => canvas.width / DPR,
  height: () => canvas.height / DPR,
  gravity: 1800
};

let player = {
  x:150,
  y:0,
  size:36,
  vy:0,
  jumpsLeft:2,
  onGround:false,
  alive:true
};

let platforms = [];
let clouds = [];
let mountainsFar = [];
let mountainsNear = [];
let birds = []; // NEW BIRDS

let speed = 260;
let maxSpeed = 900;
let runningTime = 0;
let startDelay = true;

const overlay = document.getElementById("centerOverlay");
const deathScreen = document.getElementById("deathScreen");

function rand(a,b){ return Math.random()*(b-a)+a; }
function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }

function spawnBird(){
  birds.push({
    x: WORLD.width() + rand(50,350),
    y: rand(50, WORLD.height()*0.5),
    speed: rand(60,120),
    flap: 0
  });
}

function resetGame(){
  platforms = [];
  clouds = [];
  mountainsFar = [];
  mountainsNear = [];
  birds = [];

  speed = 260;
  runningTime = 0;
  startDelay = true;
  player.alive = true;
  player.vy = 0;
  player.jumpsLeft = 2;

  // Mountains
  for(let i=0;i<4;i++){
    mountainsFar.push({
      x: i*400,
      y: WORLD.height()-220,
      w: 360,
      h: 180,
      speed:0.25
    });
  }
  for(let i=0;i<4;i++){
    mountainsNear.push({
      x: i*350,
      y: WORLD.height()-160,
      w: 260,
      h:130,
      speed:0.45
    });
  }

  // spawn some birds
  for(let i=0;i<3;i++) spawnBird();

  // Floor platform
  let groundY = WORLD.height() - 140;
  platforms.push({
    x: player.x - 60,
    y: groundY,
    w: 500,
    h: 18
  });

  // Spawn player ON platform
  player.y = groundY - player.size;

  // Initial platforms (longer now)
  let cx = platforms[0].x + platforms[0].w + 60;
  for(let i=0;i<6;i++){
    let gap = rand(80,160);
    let w = rand(260,480); // LONGER
    let y = clamp(groundY + rand(-20,60), 70, WORLD.height()-80);
    platforms.push({ x:cx+gap, y, w, h:18 });
    cx += gap + w;
  }

  // Clouds
  for(let i=0;i<6;i++){
    clouds.push({
      x: rand(0, WORLD.width()),
      y: rand(20, WORLD.height()*0.4),
      scale: rand(0.7,1.3),
      speed: rand(10,40)
    });
  }

  overlay.style.opacity = 1;
  deathScreen.style.opacity = 0;
  deathScreen.style.pointerEvents = "none";
}

function ensurePlatforms(){
  let right = -999;
  for(const p of platforms) right = Math.max(right, p.x+p.w);

  while(right < WORLD.width()+600){
    const last = platforms[platforms.length-1];
    const gap = rand(100,220);
    const w = rand(260,480); // LONGER
    const y = clamp(last.y + rand(-40,80), 70, WORLD.height()-80);
    const newX = right + gap;
    platforms.push({ x:newX, y, w, h:18 });
    right = newX + w;
  }
}

function update(dt){
  if(!player.alive) return;

  if(!startDelay){
    runningTime += dt;
    speed = Math.min(maxSpeed, speed + dt*30);
  }

  // Mountains
  for(const m of mountainsFar) m.x -= speed*m.speed*dt;
  for(const m of mountainsNear) m.x -= speed*m.speed*dt;

  // Wrap mountains
  for(const m of mountainsFar) if(m.x + m.w < -50) m.x += 400*4;
  for(const m of mountainsNear) if(m.x + m.w < -50) m.x += 350*4;

  // Clouds
  for(const c of clouds){
    c.x -= (startDelay?0:speed*0.12 + c.speed*0.02)*dt;
    if(c.x < -200) c.x = WORLD.width()+200;
  }

  // Birds
  for(const b of birds){
    b.x -= b.speed * dt;
    b.flap += dt * 8;
  }
  // Replace birds off-screen
  birds = birds.filter(b => b.x > -200);
  if(birds.length < 4) spawnBird();

  // Platforms
  for(const p of platforms) p.x -= startDelay ? 0 : speed*dt;

  if(!startDelay){
    player.vy += WORLD.gravity * dt;
    player.y += player.vy * dt;
  }

  player.onGround = false;

  // Platform collision
  for(const p of platforms){
    if(player.x+player.size > p.x && player.x < p.x+p.w){
      let bottom = player.y + player.size;
      let oldBottom = bottom - player.vy*dt;
      if(oldBottom <= p.y && bottom >= p.y && player.vy>=0){
        player.y = p.y - player.size;
        player.vy = 0;
        player.onGround = true;
        player.jumpsLeft = 2;
      }
    }
  }

  if(player.y > WORLD.height()+100){
    player.alive = false;
    deathScreen.style.opacity = 1;
    deathScreen.style.pointerEvents = "auto";
  }

  platforms = platforms.filter(p => p.x+p.w > -300);
  ensurePlatforms();
}

function drawBird(b){
  ctx.save();
  ctx.translate(b.x, b.y);
  ctx.scale(1,1);

  // flapping wings
  let wing = Math.sin(b.flap) * 6;

  ctx.strokeStyle = "#222";
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.moveTo(0,0);
  ctx.quadraticCurveTo(-15, wing, -30, 0);
  ctx.stroke();

  ctx.beginPath();
  ctx.moveTo(0,0);
  ctx.quadraticCurveTo(15, wing, 30, 0);
  ctx.stroke();

  ctx.restore();
}

function draw(){
  // Improved sky gradient
  let sky = ctx.createLinearGradient(0,0,0,WORLD.height());
  sky.addColorStop(0,"#5fa0ff");
  sky.addColorStop(0.4,"#4b8ce6");
  sky.addColorStop(1,"#345fa8");
  ctx.fillStyle = sky;
  ctx.fillRect(0,0,WORLD.width(),WORLD.height());

  // Sun glow
  ctx.save();
  let sunX = WORLD.width()*0.8;
  let sunY = WORLD.height()*0.18;
  let glow = ctx.createRadialGradient(sunX, sunY, 0, sunX, sunY, 180);
  glow.addColorStop(0,"rgba(255,255,200,0.7)");
  glow.addColorStop(1,"rgba(255,255,200,0)");
  ctx.fillStyle = glow;
  ctx.beginPath();
  ctx.arc(sunX, sunY, 180, 0, Math.PI*2);
  ctx.fill();
  ctx.restore();

  // Mountains (far)
  ctx.fillStyle = "#2f4c6b";
  for(const m of mountainsFar){
    ctx.beginPath();
    ctx.moveTo(m.x, m.y+m.h);
    ctx.lineTo(m.x+m.w*0.5, m.y);
    ctx.lineTo(m.x+m.w, m.y+m.h);
    ctx.fill();
  }

  // Mountains (near)
  ctx.fillStyle = "#3c5d82";
  for(const m of mountainsNear){
    ctx.beginPath();
    ctx.moveTo(m.x, m.y+m.h);
    ctx.lineTo(m.x+m.w*0.5, m.y);
    ctx.lineTo(m.x+m.w, m.y+m.h);
    ctx.fill();
  }

  // Clouds
  ctx.fillStyle="#fff";
  for(const c of clouds){
    ctx.beginPath();
    ctx.ellipse(c.x,c.y,40*c.scale,20*c.scale,0,0,Math.PI*2);
    ctx.ellipse(c.x+30*c.scale,c.y+3,25*c.scale,14*c.scale,0,0,Math.PI*2);
    ctx.ellipse(c.x-25*c.scale,c.y+3,22*c.scale,12*c.scale,0,0,Math.PI*2);
    ctx.fill();
  }

  // Birds
  for(const b of birds) drawBird(b);

  // Platforms
  for(const p of platforms){
    ctx.fillStyle="#0c6b2e";
    ctx.fillRect(p.x, p.y+10, p.w, 8);
    ctx.fillStyle="#2ea044";
    ctx.fillRect(p.x, p.y, p.w, 18);
  }

  // Player
  ctx.fillStyle="#ffd42a";
  ctx.fillRect(player.x, player.y, player.size, player.size);
}

function jump(){
  if(!player.alive){
    resetGame();
    return;
  }
  if(startDelay){
    // FIRST CLICK ONLY STARTS — NO JUMP
    startDelay = false;
    overlay.style.opacity = 0;
    player.jumpsLeft = 2;
    return;
  }
  if(player.jumpsLeft>0){
    player.vy = -760;
    player.jumpsLeft--;
  }
}

window.addEventListener("keydown", e=>{
  if(["Space","ArrowUp","KeyW"].includes(e.code)){
    e.preventDefault();
    jump();
  }
});
window.addEventListener("pointerdown", jump);
document.getElementById("touchButton").addEventListener("pointerdown", jump);

let last = performance.now();
function loop(now){
  const dt = Math.min(0.033, (now-last)/1000);
  last = now;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}

resetGame();
loop(performance.now());

})();
</script>

</body>
</html>
